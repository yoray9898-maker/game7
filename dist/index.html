<script>
    // 在 Enemy 類別中的 update 修正如下：
    update() {
        if (this.flash > 0) this.flash--;
        
        if (this.isBoss) {
            this.skillTimer++;
            // 狂暴判斷
            if (this.hp / this.maxHp < 0.3 && !this.berserkActive) {
                this.berserkActive = true;
                this.speed *= 2;
                this.berserkImmune = 150;
            }
            
            // 技能施放頻率 (狂暴後變快)
            let cd = this.berserkActive ? 120 : 240;
            if (this.skillTimer >= cd) {
                if(towers.length > 0) towers[Math.floor(Math.random() * towers.length)].frozenTimer = 180;
                this.skillTimer = 0;
            }
            
            // 霸體邏輯
            if (this.berserkImmune > 0) {
                this.berserkImmune--;
                this.stunned = 0; // 免疫暈眩
            }
        }

        if (this.stunned > 0) { this.stunned--; return; }

        // 移動邏輯 (霸體結束後若被緩速會受影響)
        let moveSpeed = this.speed;
        // 如果被緩速且不在霸體狀態下，速度會降低 (此處 logic 由 Bullet 類別處理)
        
        let target = pathPoints[this.tIdx];
        let dx = target.x*40 - this.x;
        let dy = target.y*40 - this.y;
        let d = Math.sqrt(dx*dx + dy*dy);

        if (d < moveSpeed) {
            this.tIdx++;
            if (this.tIdx >= pathPoints.length) { health--; this.hp = 0; }
        } else {
            this.x += (dx/d) * moveSpeed;
            this.y += (dy/d) * moveSpeed;
        }
    }
</script>
